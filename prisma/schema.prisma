// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

// Looking for ways to speed up your queries, or scale easily with your serverless or edge functions?
// Try Prisma Accelerate: https://pris.ly/cli/accelerate-init

generator client {
  provider = "prisma-client-js"
  output   = "../lib/generated/prisma"
  previewFeatures = ["postgresqlExtensions"]
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
  directUrl = env("DIRECT_URL")
  extensions = [vector]
}

model Document {
  id          String   @id @default(cuid())
  title       String
  content     String
  url         String?
  metadata    Json?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  
  chunks      DocumentChunk[]
  
  @@map("documents")
}

model DocumentChunk {
  id          String                @id @default(cuid())
  documentId  String
  content     String
  chunkIndex  Int
  embedding   Float[] @default([])
  metadata    Json?
  createdAt   DateTime              @default(now())
  
  document    Document              @relation(fields: [documentId], references: [id], onDelete: Cascade)
  
  @@map("document_chunks")
  @@index([documentId])
}

model ChatSession {
  id          String   @id @default(cuid())
  title       String?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  
  messages    ChatMessage[]
  
  @@map("chat_sessions")
}

model ChatMessage {
  id          String      @id @default(cuid())
  sessionId   String
  role        MessageRole
  content     String
  metadata    Json?
  createdAt   DateTime    @default(now())
  
  session     ChatSession @relation(fields: [sessionId], references: [id], onDelete: Cascade)
  
  @@map("chat_messages")
  @@index([sessionId])
}

enum MessageRole {
  USER
  ASSISTANT
  SYSTEM
}

model TeamMember {
  id          String   @id @default(cuid())
  name        String
  position    String
  department  String
  email       String?
  phone       String?
  bio         String?
  avatar      String?
  linkedIn    String?
  website     String?
  specialties String[] // Array de especialidades
  status      TeamMemberStatus @default(ACTIVE)
  type        TeamMemberType
  order       Int      @default(0) // Para ordenar en la página
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  
  @@map("team_members")
  @@index([type, order])
  @@index([status])
}

enum TeamMemberStatus {
  ACTIVE
  INACTIVE
}

enum TeamMemberType {
  DIRECTOR     // Directivos
  RESEARCHER   // Investigadores  
  COLLABORATOR // Colaboradores
  STAFF        // Personal administrativo
}

model InstitutionalInfo {
  id           String   @id @default(cuid())
  name         String   // Nombre de la institución
  description  String   // Descripción breve
  subtitle     String?  // Subtítulo para hero section
  mission      String   // Misión
  vision       String   // Visión
  values       String[] // Array de valores
  history      String?  // Historia (opcional)
  address      String?  // Dirección
  phone        String?  // Teléfono
  email        String?  // Email
  website      String?  // Sitio web
  foundingYear Int      // Año de fundación
  logo         String?  // URL del logo
  image        String?  // URL de imagen principal
  heroImage    String?  // URL de imagen de fondo del hero
  historyImage String?  // URL de imagen para sección de historia
  
  // Redes sociales
  instagramUrl String?  // URL de Instagram
  linkedinUrl  String?  // URL de LinkedIn
  youtubeUrl   String?  // URL de YouTube
  spotifyUrl   String?  // URL de Spotify
  
  // Características principales
  feature1Title String? // Título característica 1 (ej: "Investigación Avanzada")
  feature1Text  String? // Descripción característica 1
  feature2Title String? // Título característica 2 (ej: "Colaboraciones Estratégicas")
  feature2Text  String? // Descripción característica 2
  
  // Configuración visual
  overlayColor String?  // Color del overlay para hero section
  
  // Configuración del Footer
  footerBrand        String?  // Nombre de la marca en el footer
  footerEmail        String?  // Email de contacto en footer
  footerPhone        String?  // Teléfono de contacto en footer
  footerAddress      String?  // Dirección en footer
  footerCopyright    String?  // Texto de copyright personalizado
  footerBackgroundColor String? // Color de fondo del footer
  footerTextColor    String?  // Color del texto del footer
  footerAccentColor  String?  // Color de acento para links/iconos
  
  status       InstitutionalStatus @default(ACTIVE)
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt
  
  @@map("institutional_info")
}

enum InstitutionalStatus {
  ACTIVE
  INACTIVE
}

model News {
  id          String   @id @default(cuid())
  title       String   // Título de la noticia
  description String   // Descripción breve/resumen
  content     String?  // Contenido completo (opcional por ahora)
  imageUrl    String?  // URL de la imagen principal
  imageAlt    String?  // Texto alternativo de la imagen
  imgW        Int?     // Ancho de imagen
  imgH        Int?     // Alto de imagen
  link        String?  // Enlace externo (si aplica)
  author      String   // Autor de la noticia
  readTime    String   // Tiempo de lectura estimado (ej: "5 min")
  
  // Metadatos y configuración
  slug        String   @unique // URL amigable (ej: "nueva-investigacion-2024")
  featured    Boolean  @default(false) // Si es noticia destacada
  published   Boolean  @default(true)  // Si está publicada
  tags        String[] // Etiquetas para categorización
  
  // SEO y metadatos
  metaTitle       String? // Título para SEO
  metaDescription String? // Descripción para SEO
  
  // Fechas
  publishedAt DateTime @default(now()) // Fecha de publicación
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  
  @@map("news")
  @@index([published, publishedAt])
  @@index([featured])
  @@index([slug])
}

model Event {
  id          String   @id @default(cuid())
  title       String   // Título del evento
  description String   // Descripción del evento
  content     String?  // Descripción detallada (opcional)
  imageUrl    String?  // URL de la imagen del evento
  imageAlt    String?  // Texto alternativo de la imagen
  imgW        Int?     // Ancho de imagen
  imgH        Int?     // Alto de imagen
  link        String?  // Enlace a más información o registro
  
  // Información específica del evento
  date        String   // Fecha del evento (formato: "2025-02-15")
  time        String   // Hora del evento (formato: "14:00 - 17:00")
  location    String   // Ubicación física o virtual
  speaker     String?  // Ponente principal (opcional)
  speakers    String[] // Lista de ponentes (si hay varios)
  category    String?  // Categoría del evento (Workshop, Conferencia, etc.)
  
  // Configuración y metadatos
  slug        String   @unique // URL amigable
  featured    Boolean  @default(false) // Si es evento destacado
  published   Boolean  @default(true)  // Si está publicado
  capacity    Int?     // Capacidad máxima (opcional)
  price       Float?   // Precio (0 para gratuito, null si no aplica)
  currency    String   @default("USD") // Moneda
  tags        String[] // Etiquetas para categorización
  
  // Fechas de control
  eventDate   DateTime // Fecha real del evento para ordenamiento
  registrationEnd DateTime? // Fecha límite de registro
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  
  @@map("events")
  @@index([published, eventDate])
  @@index([featured])
  @@index([category])
  @@index([slug])
}

model SiteConfig {
  id          String   @id @default(cuid())
  
  // Metadatos básicos del sitio
  siteName         String?  @default("CIIMED") // Nombre del sitio
  siteDescription  String?  @default("Centro de Investigación e Innovación en Medicina") // Descripción general
  siteKeywords     String[] @default(["medicina", "investigación", "salud", "ciencia"]) // Keywords SEO
  siteUrl          String?  @default("https://ciimed.pa") // URL principal
  
  // SEO y metadatos específicos
  metaTitle        String?  @default("CIIMED - Centro de Investigación e Innovación en Medicina") // Title para <head>
  metaDescription  String?  @default("Ubicado en la Ciudad de la Salud, este centro es un referente en investigación y desarrollo en el ámbito de la salud en Panamá.") // Meta description
  ogImage          String?  // Imagen para Open Graph
  ogDescription    String?  // Descripción para redes sociales
  
  // Información de contacto global
  globalEmail      String?  @default("info@ciimed.pa") // Email principal
  globalPhone      String?  @default("+507 123-4567") // Teléfono principal  
  globalAddress    String?  @default("Ciudad de la Salud, Panamá") // Dirección principal
  emergencyContact String?  // Contacto de emergencia
  
  // Branding y logos
  primaryLogo      String?  @default("/logo.png") // Logo principal
  secondaryLogo    String?  @default("/logo_blanco.png") // Logo alternativo
  favicon          String?  @default("/favicon.ico") // Favicon
  
  // Colores del tema
  primaryColor     String?  @default("#285C4D") // Color primario
  secondaryColor   String?  @default("#F4633A") // Color secundario
  accentColor      String?  @default("#212322") // Color de acento
  lightColor       String?  @default("#f2f2f2") // Color claro
  
  // Redes sociales
  facebookUrl      String?  // URL de Facebook
  twitterUrl       String?  // URL de Twitter/X
  linkedinUrl      String?  // URL de LinkedIn
  instagramUrl     String?  // URL de Instagram
  youtubeUrl       String?  // URL de YouTube
  
  // Navegación principal (JSON array)
  mainNavLinks     Json?    @default("[{\"label\":\"Inicio\",\"href\":\"/\"},{\"label\":\"Sobre Nosotros\",\"href\":\"/about\"},{\"label\":\"Áreas de Investigación\",\"href\":\"/research-areas\"},{\"label\":\"Formación y Capacitación\",\"href\":\"/training\"},{\"label\":\"Alianzas Estratégicas\",\"href\":\"/partnerships\"},{\"label\":\"Participa con Nosotros\",\"href\":\"/get-involved\"},{\"label\":\"Divulgación Científica\",\"href\":\"/scientificDissemination\"},{\"label\":\"Contacto\",\"href\":\"/contact\"}]") // Links de navegación
  
  // Mensajes del sistema
  notFoundTitle    String?  @default("Página no encontrada") // Título 404
  notFoundMessage  String?  @default("No se pudo encontrar el recurso solicitado.") // Mensaje 404
  notFoundButton   String?  @default("Volver a la página principal") // Botón 404
  
  // Configuración técnica
  isActive         Boolean  @default(true) // Solo una configuración activa
  version          String?  @default("1.0.0") // Versión de configuración
  
  // Fechas de control
  createdAt        DateTime @default(now())
  updatedAt        DateTime @updatedAt
  
  @@map("site_config")
  @@index([isActive])
}

model ResearchProject {
  id          String   @id @default(cuid())
  
  // Información básica
  title       String   // Título del proyecto
  slug        String   @unique // URL amigable
  description String   // Descripción corta
  abstract    String?  @db.Text // Resumen ejecutivo detallado
  objectives  String[] // Objetivos específicos del proyecto
  
  // Clasificación y organización
  researchLine     String?  // Línea de investigación principal
  category         String?  // Categoría general (Clínica, Básica, Epidemiológica, etc.)
  area             String?  // Área específica (Cardiología, Oncología, etc.)
  status           String   @default("planning") // planning, active, paused, completed, cancelled
  priority         Int      @default(0) // 0-10 prioridad del proyecto
  tags             String[] // Etiquetas para búsqueda y categorización
  
  // Información temporal
  startDate        String?  // Fecha de inicio (formato: "2025-01-15")
  endDate          String?  // Fecha de finalización estimada
  actualEndDate    String?  // Fecha real de finalización
  estimatedDuration String? // Duración estimada en texto (ej: "18 meses")
  currentProgress   Int     @default(0) // Progreso actual 0-100%
  
  // Recursos y financiamiento
  principalInvestigator String?  // Investigador principal
  coInvestigators      String[] // Co-investigadores
  budget               Decimal? @db.Decimal(12,2) // Presupuesto total
  fundingSource        String?  // Fuente de financiamiento
  currency             String?  @default("USD") // Moneda del presupuesto
  currentFunding       Decimal? @db.Decimal(12,2) // Financiamiento actual obtenido
  
  // Documentación y multimedia
  imageUrl        String?  // Imagen principal del proyecto
  imageAlt        String?  // Texto alternativo de la imagen
  imgW            Int?     // Ancho de imagen
  imgH            Int?     // Alto de imagen
  documentsUrls   String[] // URLs de documentos relacionados
  publicationsUrls String[] // URLs de publicaciones resultantes
  presentationsUrls String[] // URLs de presentaciones
  
  // Resultados e impacto
  expectedResults  String?  @db.Text // Resultados esperados
  currentResults   String?  @db.Text // Resultados actuales obtenidos
  impactMeasures   String[] // Métricas de impacto
  publications     Int?     @default(0) // Número de publicaciones generadas
  citations        Int?     @default(0) // Citas recibidas
  
  // Colaboraciones y participación
  institutionalPartners String[] // Socios institucionales
  internationalPartners String[] // Socios internacionales
  studentParticipants   Int?     @default(0) // Estudiantes participantes
  
  // Configuración y metadatos
  featured        Boolean  @default(false) // Si es proyecto destacado
  published       Boolean  @default(true)  // Si está publicado públicamente
  allowPublicView Boolean  @default(true)  // Permitir vista pública
  link            String?  // Enlace a página específica del proyecto
  
  // Información técnica
  methodology     String?  @db.Text // Metodología del proyecto
  ethicsApproval  String?  // Aprobación ética (número/referencia)
  equipment       String[] // Equipos necesarios/utilizados
  software        String[] // Software utilizado
  
  // Fechas de control
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt
  
  @@map("research_projects")
  @@index([status, priority])
  @@index([published, featured])
  @@index([researchLine, category])
  @@index([slug])
  @@index([startDate, endDate])
}

model MediaGallery {
  id          String   @id @default(cuid())
  
  // Información básica
  title       String   // Título del elemento multimedia
  slug        String   @unique // URL amigable
  description String   // Descripción del elemento
  alt         String?  // Texto alternativo (importante para accesibilidad)
  
  // Tipo y categorización
  type        MediaType // Tipo de medio: IMAGE, VIDEO, DOCUMENT, AUDIO
  category    String?  // Categoría general (Investigación, Eventos, Institucional, etc.)
  subcategory String?  // Subcategoría específica
  tags        String[] // Etiquetas para búsqueda y filtrado
  
  // URLs y archivos
  fileUrl     String   // URL principal del archivo
  thumbnailUrl String? // URL de miniatura/preview
  previewUrl   String? // URL de vista previa (para videos)
  
  // Metadatos del archivo
  fileName    String?  // Nombre original del archivo
  fileSize    Int?     // Tamaño en bytes
  mimeType    String?  // Tipo MIME (image/jpeg, video/mp4, etc.)
  duration    Int?     // Duración en segundos (para videos/audio)
  
  // Dimensiones (para imágenes y videos)
  width       Int?     // Ancho en píxeles
  height      Int?     // Alto en píxeles
  aspectRatio String?  // Ratio de aspecto (16:9, 4:3, etc.)
  
  // Información de contexto
  author      String?  // Autor o fotógrafo
  source      String?  // Fuente original
  copyright   String?  // Información de derechos de autor
  license     String?  // Tipo de licencia (Creative Commons, etc.)
  
  // Ubicación y fecha
  location    String?  // Ubicación donde se tomó/grabó
  capturedAt  DateTime? // Fecha cuando se capturó el medio
  eventDate   String?  // Fecha del evento relacionado (formato: "2025-01-15")
  
  // Configuración y estado
  featured    Boolean  @default(false) // Si es elemento destacado
  published   Boolean  @default(true)  // Si está publicado
  allowDownload Boolean @default(false) // Permitir descarga directa
  quality     MediaQuality @default(HIGH) // Calidad del archivo
  
  // Organización y ordenamiento
  collection  String?  // Colección a la que pertenece
  albumId     String?  // ID del álbum si forma parte de uno
  order       Int      @default(0) // Orden dentro de la galería
  priority    Int      @default(0) // Prioridad de mostrado (0-10)
  
  // Enlaces relacionados
  relatedLink String?  // Enlace relacionado (noticia, evento, etc.)
  externalUrl String?  // URL externa si aplica
  
  // SEO y metadatos
  metaTitle       String? // Título para SEO
  metaDescription String? // Descripción para SEO
  keywords        String[] // Palabras clave específicas
  
  // Configuración de visualización
  showInGallery   Boolean @default(true)  // Mostrar en galería principal
  showInSlideshow Boolean @default(false) // Incluir en slideshow
  allowComments   Boolean @default(false) // Permitir comentarios
  
  // Estadísticas
  views       Int      @default(0) // Número de visualizaciones
  downloads   Int      @default(0) // Número de descargas
  
  // Fechas de control
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  
  @@map("media_gallery")
  @@index([type, published])
  @@index([category, subcategory])
  @@index([featured, priority])
  @@index([collection, order])
  @@index([tags])
  @@index([capturedAt, eventDate])
  @@index([slug])
}

enum MediaType {
  IMAGE     // Imágenes (JPG, PNG, GIF, SVG, WebP)
  VIDEO     // Videos (MP4, WebM, MOV, AVI)
  DOCUMENT  // Documentos (PDF, DOC, PPT, XLS)
  AUDIO     // Audio (MP3, WAV, OGG)
}

enum MediaQuality {
  LOW       // Baja calidad/comprimido
  MEDIUM    // Calidad media
  HIGH      // Alta calidad
  ORIGINAL  // Calidad original sin comprimir
}
